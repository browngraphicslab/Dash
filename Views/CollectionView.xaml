<UserControl
    x:Class="Dash.CollectionView"
    x:Name="Control"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:dash="using:Dash"
    mc:Ignorable="d"
    ManipulationStarted="Grid_OnManipulationStarted">

    <Grid x:Name="Grid" BorderThickness="0" Background="#F339519F">
        <Grid x:Name="DocumentViewContainerGrid"  
                  HorizontalAlignment="Stretch" 
                  BorderThickness="0" 
                  Margin="0,30,0,30" 
                  VerticalAlignment="Stretch"  
                  BorderBrush="WhiteSmoke"
                  SizeChanged="DocumentViewContainerGrid_OnSizeChanged" 
                  ManipulationMode="All" 
                  PointerWheelChanged="UserControl_PointerWheelChanged"
                  ManipulationDelta="UserControl_ManipulationDelta" 
                  ManipulationInertiaStarting="UserControl_ManipulationInertiaStarting" 
                  PointerMoved="FreeformGrid_OnPointerMoved" 
                  PointerReleased="FreeformGrid_OnPointerReleased"
                  Background="#3F343434">
            <Grid.Clip>
                <RectangleGeometry x:Name="ClipRect"/>
            </Grid.Clip>
            <Grid x:Name="FreeformGrid" Visibility="{Binding GridViewVisibility}">
                <ItemsControl x:Name="GridView" 
                                  x:FieldModifier="public" 
                                  Padding="5" 
                                  ItemsSource="{Binding DataBindingSource}"
                                  IsEnabled="{Binding ViewIsEnabled}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <Canvas x:Name="CollectionCanvas" x:FieldModifier="public"></Canvas>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <dash:DocumentView 
                                    Width="300" 
                                    Height="300" 
                                    DataContext="{Binding}" 
                                    ManipulationStarted="DocumentView_ManipulationStarted" 
                                    ManipulationDelta="DocumentView_ManipulationDelta" 
                                    IODragStarted="StartDrag" 
                                    IODragEnded="EndDrag">
                                <dash:DocumentView.RenderTransform>
                                    <TranslateTransform X="{Binding X}" Y="{Binding Y}">
                                    </TranslateTransform>
                                </dash:DocumentView.RenderTransform>
                            </dash:DocumentView>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </Grid>

            <Grid Visibility="{Binding ListViewVisibility}">
                <ListView x:Name="HListView" x:FieldModifier="public" FlowDirection="LeftToRight" HorizontalAlignment="Left" 
                              VerticalAlignment="Top"  Width="{Binding Path=ContainerGridWidth}" 
                              ScrollViewer.HorizontalScrollMode="Enabled"
                              ScrollViewer.VerticalScrollMode="Disabled"
                              ScrollViewer.VerticalScrollBarVisibility="Disabled"
                              ScrollViewer.HorizontalScrollBarVisibility="Auto"
                              SelectionMode="{Binding ItemSelectionMode}"
                              ItemsSource="{Binding DataBindingSource}"
                              IsEnabled="{Binding ViewIsEnabled}">
                    <ListView.ItemsPanel>
                        <ItemsPanelTemplate>
                            <ItemsStackPanel Background="Transparent" Orientation="Horizontal"/>
                        </ItemsPanelTemplate>
                    </ListView.ItemsPanel>
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Border Width="{Binding ElementName=Grid, Path=DataContext.CellSize}" Height="{Binding ElementName=Grid, Path=DataContext.CellSize}">
                                <dash:DocumentView DataContext="{Binding}"></dash:DocumentView>
                            </Border>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </Grid>
        </Grid>

        <Grid Visibility="{Binding SoloDisplayVisibility}">
            <Grid x:Name="SingleDocDisplayGrid" Width="{Binding OuterGridWidth}" Height="{Binding ContainerGridHeight}" HorizontalAlignment="Center" VerticalAlignment="Center">
                <Grid.Background>
                    <SolidColorBrush Color="White" Opacity="0.75"/>
                </Grid.Background>
                <Grid Width="{Binding SoloDisplaySize}" Height="{Binding SoloDisplaySize}">
                    <ListView x:Name="SoloDisplayListView" x:FieldModifier="public" FlowDirection="LeftToRight" HorizontalAlignment="Center" 
                              VerticalAlignment="Center"  
                              ScrollViewer.HorizontalScrollMode="Disabled"
                              ScrollViewer.VerticalScrollMode="Enabled"
                              ScrollViewer.VerticalScrollBarVisibility="Auto"
                              ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                              ItemsSource="{Binding SoloDisplayElements}"
                              Background="LightSlateGray">
                        <ListView.ItemsPanel>
                            <ItemsPanelTemplate>
                                <ItemsStackPanel Background="Transparent" Orientation="Vertical"/>
                            </ItemsPanelTemplate>
                        </ListView.ItemsPanel>
                    </ListView>
                </Grid>

            </Grid>
        </Grid>

        <Grid x:Name="FilterGrid" Visibility="{Binding FilterViewVisibility}">
            <StackPanel Orientation="Vertical" Width="605" Height="305" Style="{StaticResource xNodeContainerStackPanel}">
                <Button x:Name="xFilterExit" Content="X" HorizontalAlignment="Right" Height="30" Style="{StaticResource xBlueTextButtonStyle}"/>
                <TextBlock Text="Filter Collection" Height="60" HorizontalAlignment="Center" FontSize="45"
                           Style="{StaticResource xBlueTextBoxStyle}" />
                <Grid x:Name="xMainGrid" VerticalAlignment="Center" Height="90"
                      d:LayoutOverrides="LeftMargin, RightMargin">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="35" />
                        <ColumnDefinition Width="165" />
                        <ColumnDefinition Width="15" />
                        <ColumnDefinition />
                        <ColumnDefinition Width="15" />
                        <ColumnDefinition Width="165" />
                        <ColumnDefinition Width="35" />
                    </Grid.ColumnDefinitions>
                    <Grid Grid.Column="1" d:LayoutOverrides="LeftMargin, RightMargin, TopMargin, BottomMargin">
                        <ComboBox x:Name="xComboBox" Width="165" Height="30" HorizontalAlignment="Center"
                                  VerticalAlignment="Center" d:LayoutOverrides="Height" BorderBrush="LightSlateGray">
                            <ComboBoxItem x:Name="xHasField" Tapped="hasField_Tapped">Has field</ComboBoxItem>
                            <ComboBoxItem x:Name="xFieldContains" Tapped="fieldContains_Tapped">Field contains</ComboBoxItem>
                            <ComboBoxItem x:Name="xFieldEquals" Tapped="fieldEquals_Tapped">Field equals</ComboBoxItem>
                        </ComboBox>
                        <Grid.Resources>
                            <Storyboard x:Name="xHideFieldBox">
                                <FadeOutThemeAnimation TargetName="xFieldBox" />
                            </Storyboard>
                            <Storyboard x:Name="xShowFieldBox" Duration="0:0:1">
                                <FadeInThemeAnimation TargetName="xFieldBox" />
                            </Storyboard>
                        </Grid.Resources>
                    </Grid>
                    <Grid Grid.Column="3" x:Name="xFieldBoxColumn" Width="165"
                          d:LayoutOverrides="LeftMargin, RightMargin, TopMargin, BottomMargin">
                        <AutoSuggestBox x:Name="xFieldBox" PlaceholderText="Enter field here" 
                                 Height="32" BorderBrush="LightSlateGray" AutoMaximizeSuggestionArea="False" Margin="0,30,34,0"/>
                        <Grid.Resources>
                            <Storyboard x:Name="xCollapseMainGrid" Storyboard.TargetName="xMainGrid"
                                        Completed="xCollapseMainGrid_Completed">
                                <DoubleAnimation Storyboard.TargetProperty="Width" From="605" To="435"
                                                 Duration="0:0:0.3" EnableDependentAnimation="True" />
                            </Storyboard>
                            <Storyboard x:Name="xExpandMainGrid" Storyboard.TargetName="xMainGrid"
                                        Completed="xExpandMainGrid_Completed">
                                <DoubleAnimation Storyboard.TargetProperty="Width" From="435" To="605"
                                                 Duration="0:0:0.3" EnableDependentAnimation="True" />
                            </Storyboard>
                        </Grid.Resources>
                    </Grid>
                    <Grid Grid.Column="5" d:LayoutOverrides="LeftMargin, RightMargin, TopMargin, BottomMargin">
                        <TextBox x:Name="xSearchBox" PlaceholderText="Search" VerticalAlignment="Stretch" Height="30"
                                 BorderBrush="LightSlateGray" TextChanged="xSearchBox_TextChanged"/>
                        <AutoSuggestBox x:Name="xSearchFieldBox" PlaceholderText="Enter field here" 
                                 Height="30" BorderBrush="LightSlateGray" TextChanged="XFieldBox_OnTextChanged" AutoMaximizeSuggestionArea="False" Margin="0,30,0,0" Visibility="Collapsed" UpdateTextOnSelect="True"/>
                    </Grid>
                </Grid>
                <Button x:Name="xFilterButton" Visibility="Collapsed" Content="Filter" Width="75" VerticalAlignment="Center"
                        HorizontalAlignment="Center" Style="{StaticResource xBlueTextButtonStyle}" FontSize="20" Height="30"
                         Margin="30" />
            </StackPanel>
        </Grid>


        <!--<Button x:Name="CancelButton" HorizontalAlignment="Right" VerticalAlignment="Top" Width="62" Height="29" Content="Cancel" Background="{x:Null}" Foreground="{StaticResource ButtonTextBrush}" BorderBrush="{x:Null}" Padding="0" Margin="0,0,10,0"  />-->

        <Button x:Name="DisplayButton" HorizontalAlignment="Left" VerticalAlignment="Top" Height="30" Width="60" 
                Style="{StaticResource xBlueTextButtonStyle}" Foreground="WhiteSmoke" Margin="0,0,0,0" Content="Display" FontSize="14" FontFamily="Rockwell">
            <Button.Flyout>
                <MenuFlyout >
                    <MenuFlyoutItem x:Name="GridOption" Text="Grid"/>
                    <MenuFlyoutItem x:Name="ListOption" Text="List"/>
                </MenuFlyout>
            </Button.Flyout>
        </Button>

        <StackPanel Orientation="Horizontal">
            <Button x:Name="DeleteButton" x:FieldModifier="public"  Content="Options" VerticalAlignment="Bottom" Height="30" 
                        Width="60" Style="{StaticResource xBlueTextButtonStyle}" Foreground="WhiteSmoke" Margin="{Binding DeleteButtonMargin}" FontSize="14" FontFamily="Rockwell">
                <Button.Flyout>
                    <MenuFlyout Placement="Bottom">
                        <MenuFlyoutItem x:Name="DeleteSelected" Text="Delete"/>
                        <MenuFlyoutItem x:Name="Filter" Text="Filter"/>
                        <MenuFlyoutItem x:Name="ClearFilter" Text="Clear Filter"/>
                    </MenuFlyout>
                </Button.Flyout>
            </Button>
            <Button x:Name="SelectButton" Content ="Select" VerticalAlignment="Bottom" Height="30" 
                        Width="60" Style="{StaticResource xBlueTextButtonStyle}" Foreground="WhiteSmoke" Margin="{Binding SelectButtonMargin}" FontSize="14" FontFamily="Rockwell"/>
        </StackPanel>
        <Button x:Name="CloseButton" Content ="Close" HorizontalAlignment="Right" VerticalAlignment="Top" Height="30" 
                Width="50" Style="{StaticResource xBlueTextButtonStyle}" Foreground="WhiteSmoke" FontSize="14" FontFamily="Rockwell"/>
        <Ellipse x:Name="ConnectionEllipse"
                 x:FieldModifier="public"
                 Width="20" 
                 Height="20" 
                 Fill="Goldenrod" 
                 HorizontalAlignment="Right" 
                 StrokeThickness="2" 
                 Stroke="DarkGoldenrod"
                 ManipulationMode="All"
                 ManipulationStarted="ConnectionEllipse_OnManipulationStarted" 
                 PointerPressed="ConnectionEllipse_OnPointerPressed"/>
    </Grid>
</UserControl>



