<local:SelectionElement
    x:Name="This"
    x:Class="Dash.DocumentView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Dash"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    d:DataContext="{d:DesignInstance local:DocumentViewModel}"
    d:DesignWidth="400"
    d:DesignHeight="400"
    xmlns:localConverters="using:Dash.Converters"
    xmlns:controls="using:Microsoft.Toolkit.Uwp.UI.Controls"
    AllowDrop="True" DragOver="DocumentView_OnDragOver"
    DragEnter="DocumentView_OnDragOver" RightTapped="DocumentView_OnRightTapped"
    PointerPressed="DocumentView_OnPointerPressed">
    <UserControl.Resources>
        <Storyboard x:Name="FadeOut" Completed="FadeOut_Completed" SpeedRatio="0.7">
            <FadeOutThemeAnimation TargetName="This"></FadeOutThemeAnimation>
        </Storyboard>
        <localConverters:DocumentViewModelToStringConverter x:Key="DocumentViewModelToStringConverter" />
        <local:BoolToBrushConverter x:Key="BoolToBrushConverter"/>
        <SolidColorBrush x:Key="DocumentBackground" Color="{ThemeResource DocumentBackgroundColor}"></SolidColorBrush>
    </UserControl.Resources>
    <Grid>
        <!--The cloud bubble margins-->
        <Grid Height="{Binding GroupMargin}" Margin="-10 0 -10 -30"  VerticalAlignment="Bottom" Background="#01010101" x:Name="BorderRegion1" >
            <Grid CornerRadius="10" Opacity="0.25" Height="20" >
                <Grid.Background>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="0 1">
                        <GradientStop Color="Transparent" Offset="1"/>
                        <GradientStop Color="{Binding BorderGroupColor}" Offset="0"/>
                    </LinearGradientBrush>
                </Grid.Background>
            </Grid>
        </Grid>
        <Grid Margin="-35 0 0 -10"  x:Name="BorderRegion2" Opacity="1" Width="{Binding GroupMargin}" Background="#01010101" HorizontalAlignment="Left" >
            <Grid CornerRadius="10" Opacity="0.25" Width="20" >
                <Grid.Background>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                        <GradientStop Color="Transparent" Offset="0"/>
                        <GradientStop Color="{Binding BorderGroupColor}" Offset="1"/>
                    </LinearGradientBrush>
                </Grid.Background>
            </Grid>
        </Grid>
        <Grid Margin="0 0 -35 -10" x:Name="BorderRegion3" Opacity="1" Width="{Binding GroupMargin}" Background="#01010101" HorizontalAlignment="Right" >
            <Grid CornerRadius="10" Opacity="0.25" Width="20"  >
                <Grid.Background>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1 0">
                        <GradientStop Color="Transparent" Offset="1"/>
                        <GradientStop Color="{Binding BorderGroupColor}" Offset="0"/>
                    </LinearGradientBrush>
                </Grid.Background>
            </Grid>
        </Grid>
        <!-- Main document view -->

        <Grid x:Name="OuterGrid" x:FieldModifier="public">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>


            <!-- Context flyout for right-click context menu; this opens automatically when the DocumentView grid is right clicked and is dismissed when anything else is clicked-->
            <Grid.ContextFlyout>
                <MenuFlyout x:Name = "xMenuFlyout">
                    <!-- There's a MenuFlyoutItem for each clickable item in the right click menu for DocumentViews; CollectionViews will add more items to this-->
                    <MenuFlyoutItem Text="Delete" Icon="Delete" Click="MenuFlyoutItemDelete_Click"/>
                    <MenuFlyoutSeparator/>
                    <MenuFlyoutItem Text="Duplicate" Icon="Copy" Click="MenuFlyoutItemCopy_Click"/>
                    <MenuFlyoutItem Text="Alias" Click="MenuFlyoutItemAlias_Click"/>
                    <MenuFlyoutSeparator/>
                    <MenuFlyoutItem Text="Edit" Click="MenuFlyoutItemLayout_Click"/>
                    <MenuFlyoutItem Text="Open fields" Click="MenuFlyoutItemAdd_Click"/>
                    <MenuFlyoutItem Text="Context" Click="MenuFlyoutItemContext_Click"/>
                    <MenuFlyoutSeparator/>
                    <MenuFlyoutItem Text="Screen capture" Click="MenuFlyoutItemScreenCap_Click"/>
                </MenuFlyout>
            </Grid.ContextFlyout>





            <!--Used to render the drop shadow and provide a background to the document-->
            <Canvas x:Name="xShadowHost"  Grid.RowSpan="2" HorizontalAlignment="Stretch" VerticalAlignment="Stretch"/>
            <Rectangle x:Name="xDocumentBackground" Grid.Row="0" Grid.RowSpan="2" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Fill="Transparent"/>

            <!--The title bar on top of the documents-->
            <Border x:Name="xTitleBorder" Visibility="{Binding Path=HasTitle,Converter={StaticResource BoolToVisibilityConverter}}" Opacity=".75" HorizontalAlignment="Stretch" Background="Transparent" VerticalAlignment="Top" Grid.Row="0" BorderThickness="0,0,0,1" Height="25" Margin="5,-25,0,0" Padding="0,0,0,3">
                <StackPanel HorizontalAlignment="Left" Orientation="Horizontal" Padding="0,0,5,0">
                    <TextBlock x:Name="xTitleIcon" FontFamily="{StaticResource FontAwesome}" Foreground="{ThemeResource TitleText}" Padding="0" Margin="0,3,4,0" FontSize="16" Text="{StaticResource DocumentPlainIcon}" />
                    <TextBox PlaceholderText="Title" Text="" Padding="0" Foreground="{ThemeResource TitleText}" Background="Transparent" x:Name="xTitle" BorderThickness="0" FontSize="15" KeyDown="XTitle_OnKeyDown" LostFocus="XTitle_LostFocus"></TextBox>
                </StackPanel>
            </Border>

            <!--grid to hold the inner content of the document-->
            <Grid Name="xTargetContentGrid" Grid.Row="1" BorderBrush="LightGray"> 
                <!-- Container for document fields view -->
                <Grid x:Name="xFieldContainer" x:FieldModifier="public">
                    <FlyoutBase.AttachedFlyout >
                        <Flyout Placement="Bottom">
                            <TextBox Name="CmdLine" AcceptsReturn="True" Background="Yellow" Height="50" Width="200" TextChanged="CommandLine_TextChanged"  />
                        </Flyout>
                    </FlyoutBase.AttachedFlyout>
                    <ContentPresenter x:Name="xContentPresenter" x:FieldModifier="public" Grid.Row="0" Content="{Binding Content}" />
                </Grid>
                <!-- Dragger Button-->
                <Button x:Name="DraggerButton"
                        x:FieldModifier="public"
                        Margin="0,0,-20,-20"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Bottom"
                        ManipulationMode="TranslateX, TranslateY"
                        Visibility="{Binding IsSelected, Converter={StaticResource BoolToVisibilityConverter}}">
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                        </ControlTemplate>
                    </Button.Template>
                    <Border Padding="10,10,20,20" Background="Transparent">
                        <Image x:Name="xDragImage" Source="ms-appx:///Assets/resize.png" Height="20" Opacity=".25" Margin="0,0,2,2" Stretch="None"
                                HorizontalAlignment="Right" VerticalAlignment="Bottom" />
                    </Border>
                </Button>
            </Grid>
            <ProgressRing x:Name="xProgressRing" Grid.Row="1" x:FieldModifier="public" Width="50" Height="50" IsActive="False" Visibility="Collapsed"/>
        </Grid>

    </Grid>
</local:SelectionElement>